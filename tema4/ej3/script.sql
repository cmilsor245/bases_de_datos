CREATE DATABASE tema4_relacion1;
USE EMPRESA ;

CREATE TABLE tcentr(
  NUMCE INT NOT NULL,
  NOMCE VARCHAR(45) NOT NULL,
  SEÑAS VARCHAR(45) NOT NULL,
  PRIMARY KEY (NUMCE)
);

CREATE TABLE tdepto(
  NUMDE INT NOT NULL,
  NOMDE VARCHAR(45) NOT NULL,
  PRESU DECIMAL(7,2) NOT NULL,
  TIDIR CHAR(1) NULL,
  DIREC INT NULL,
  DEPDE INT NULL,
  NUMCE INT NULL,
  PRIMARY KEY (NUMDE),
  FOREIGN KEY (NUMCE) REFERENCES tcentr (NUMCE)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
  FOREIGN KEY (DEPDE)
  REFERENCES tdepto (NUMDE)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION
);

CREATE TABLE temple(
  NUMEM INT NOT NULL,
  NOMEM VARCHAR(45) NOT NULL,
  FECNA DATE NOT NULL,
  FECIN DATE NOT NULL,
  NUMHI SMALLINT NOT NULL,
  SALAR DECIMAL(6,2) NOT NULL,
  COMIS DECIMAL(6,2) NULL,
  EXTEL VARCHAR(4) NOT NULL,
  NUMDE INT NULL,
  PRIMARY KEY (NUMEM),
  FOREIGN KEY (NUMDE) REFERENCES tdepto (NUMDE)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION
);

ALTER TABLE tdepto ADD CONSTRAINT restriccion1 FOREIGN KEY (DIREC) REFERENCES temple (NUMEM) ON DELETE NO ACTION ON UPDATE NO ACTION;

INSERT INTO tcentr (NUMCE, NOMCE,SEÑAS) VALUES (10, 'SEDE CENTRAL','C. ALCALA, 820, MADRID'), (20, 'RELACION CON CLIENTES','C. ATOCHA, 405, MADRID');

INSERT INTO tdepto (NUMDE, NUMCE, DIREC, TIDIR, PRESU, DEPDE, NOMDE) VALUES (100, 10, NULL, 'P', 12000.00, NULL, 'DIRECCIÓN GENERAL'), (110, 20, NULL, 'P', 5000.00, NULL, 'NOMINAS'), (111, 20, NULL, 'F', 11000.00, 110, 'SECTOR INDUSTRIAL'), (112, 20, NULL, 'P', 9000.00, 110, 'SECTOR SERVICIOS'), (120, 10, NULL, 'F', 3000.00, 100, 'ORGANIZACION'), (121, 10, NULL, 'P', 2000.00, 120, 'PERSONAL');

UPDATE tdepto SET DEPDE=120 WHERE NUMDE=110;

INSERT INTO temple (NUMEM, NUMDE, EXTEL, FECNA, FECIN, SALAR, COMIS, NUMHI, NOMEM) VALUES(110, 121, 350, '1989-11-10', '2011-02-15', 1000.00, NULL, 3, 'PONS, CESAR'), (130, 112, 810, '1966-09-09', '2011-02-01' ,1200.00, 1100.00 , 2, 'TEROL, LUCIANO'),	(150, 121, 340, '1971-01-10', '2010-01-15', 2200.00, NULL, 1, 'PEREZ, JULIO'), (180, 110, 508, '1980-01-18','2011-03-18', 1800.00, 500.00, 2, 'PEREZ, MARCOS'), (190, 110, 350, '1982-05-12','2010-02-11', 1500.00, NULL, 4, 'VEIGA, JULIANA'), (240, 111, 760, '1984-02-26','2010-02-24', 2200.00, 1000.00, 3, 'SANZ, LAVINIA'), (260, 100, 220, '1979-12-03','2010-07-12', 2200.00, NULL	, 6, 'LOPEZ, ANTONIO'), (270, 112, 800, '1978-05-21', '2010-09-10', 2200.00, 800.00, 3, 'GARCIA, OCTAVIO'), (280, 120, 410, '1973-01-11','2010-10-08', 1500.00, NULL, 5, 'FLOR, DOROTEA'), (290, 120, 910, '1974-11-30', '2010-02-14', 2200.00, NULL, 3, 'GIL, GLORIA'), (330, 112, 850, '1984-08-19', '2011-03-01', 1500.00, 900.00, 0, 'DIEZ, AMELIA'), (360, 111, 750, '1980-10-29', '2011-10-10', 1800.00, 1000.00, 2, 'LARA, LUCRECIA'), (370, 121, 360, '1985-06-22', '2022-01-20', 1800.00, NULL, 1, 'RUIZ, FABIOLA'), (380, 112, 880, '1980-03-30', '2022-01-01' ,1800.00, NULL, 0, 'MARTÍN, MICAELA');

UPDATE tdepto SET DIREC=260 WHERE NUMDE=100;
UPDATE tdepto SET DIREC=290 WHERE NUMDE=110;
UPDATE tdepto SET DIREC=240 WHERE NUMDE=111;
UPDATE tdepto SET DIREC=270 WHERE NUMDE=112;
UPDATE tdepto SET DIREC=150 WHERE NUMDE=121;